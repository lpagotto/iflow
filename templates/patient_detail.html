{% extends "base.html" %}
{% block content %}

{% if creating %}
<h1 class="text-xl font-semibold mb-4">Cadastrar paciente</h1>
<form method="post" class="bg-white border rounded p-4 max-w-lg space-y-3">
  <div>
    <label class="block text-sm mb-1">Nome</label>
    <input name="name" class="w-full border rounded px-3 py-2" required />
  </div>
  <div>
    <label class="block text-sm mb-1">CPF</label>
    <input name="cpf" class="w-full border rounded px-3 py-2" required />
  </div>
  <div>
    <label class="block text-sm mb-1">WhatsApp (somente números, com DDI/DD)</label>
    <input name="whatsapp" class="w-full border rounded px-3 py-2" placeholder="55DDDXXXXXXXXX" required />
  </div>
  <button class="px-3 py-2 rounded bg-blue-600 text-white text-sm">Salvar</button>
</form>

{% else %}
<div class="flex items-center justify-between mb-4">
  <h1 class="text-xl font-semibold">Paciente</h1>
  <form method="post" action="/web/patients/{{ patient.id }}/send-instructions">
    <button class="px-3 py-2 rounded bg-green-600 text-white text-sm hover:bg-green-700">
      Enviar instruções no WhatsApp
    </button>
  </form>
</div>

<div class="bg-white border rounded p-4 mb-6">
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
    <div><div class="text-gray-500">Nome</div><div class="font-medium">{{ patient.name }}</div></div>
    <div><div class="text-gray-500">CPF</div><div class="font-medium">{{ patient.cpf }}</div></div>
    <div><div class="text-gray-500">WhatsApp</div><div class="font-medium">{{ patient.whatsapp }}</div></div>
  </div>
</div>

<h2 class="text-lg font-semibold mb-3">Exames</h2>
<div class="bg-white border rounded">
  <table class="w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="text-left p-2">ID</th>
        <th class="text-left p-2">Status</th>
        <th class="text-left p-2">Áudio</th>
        <th class="text-left p-2">PDF</th>
        <th class="text-left p-2">Atualizado</th>
      </tr>
    </thead>
    <tbody>
      {% for e in exams %}
      <tr class="border-t">
        <td class="p-2">{{ e.id }}</td>
        <td class="p-2">
          {% if e.status == 'done' %}
            <span class="text-green-700 font-medium">Concluído</span>
          {% elif e.status == 'processing' %}
            <span class="text-amber-700 font-medium">Processando</span>
          {% elif e.status == 'failed' %}
            <span class="text-red-700 font-medium">Falhou</span>
          {% else %}
            <span class="text-gray-700">{{ e.status }}</span>
          {% endif %}
        </td>
        <td class="p-2">
          {% if e.audio_url %}
          <a class="text-blue-600 hover:underline" href="{{ e.audio_url }}" target="_blank">abrir</a>
          {% else %}
          —
          {% endif %}
        </td>
        <td class="p-2">
          {% if e.pdf_url %}
          <a class="text-blue-600 hover:underline" href="{{ e.pdf_url }}" target="_blank">download</a>
          {% else %}
          —
          {% endif %}
        </td>
        <td class="p-2">{{ e.updated_at or e.created_at }}</td>
      </tr>
      {% else %}
      <tr><td class="p-4 text-gray-500" colspan="5">Sem exames ainda.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% endblock %}
